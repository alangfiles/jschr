let Rom,Utility,fs;_c3b‍.w("./Rom.js",[["Rom",["Rom"],function(v){Rom=v}]]);_c3b‍.w("./Utility.js",[["Utility",["Utility"],function(v){Utility=v}]]);_c3b‍.w("fs",[["default",["fs"],function(v){fs=v}]]);



function generateCHR() {
  const arrayBuffer = fs.readFileSync("./mario.nes");

  const rom = new Rom(arrayBuffer);

  const MemorySize = 8191;

  let chr = [];

  for (let memoryAddress = 0; memoryAddress < MemorySize; memoryAddress++) {
    const firstPlane = [];
    for (let i = 0; i < 8; i++) {
      _c3b‍.g.console.log("memoryAddress", memoryAddress);
      const data = rom.load(memoryAddress);
      if (data) {
        const eightBits = "00000000" + data.toString(2);
        firstPlane.push(eightBits.substr(eightBits.length - 8));
      } else {
        console.log("failed");
        firstPlane.push("00000000");
      }
      memoryAddress++;
    }
    const secondPlane = [];
    for (let i = 0; i < 8; i++) {
      _c3b‍.g.console.log("memoryAddress", memoryAddress);
      const data = rom.load(memoryAddress);
      if (data) {
        const eightBits = "00000000" + data.toString(2);
        secondPlane.push(eightBits.substr(eightBits.length - 8));
      } else {
        console.log("failed");
        secondPlane.push("00000000");
      }
      memoryAddress++;
    }
    try {
      const combined = Utility.combinePlanes(firstPlane, secondPlane);

      chr.push(combined);
    } catch (e) {
      console.log("---------------------------");
      _c3b‍.g.console.log("first", firstPlane);
      _c3b‍.g.console.log("secondPlane", secondPlane);
      console.log("---------------------------");
    }
  }

  fs.writeFileSync("./data.txt", JSON.stringify(chr));
  return chr;
}

generateCHR();
